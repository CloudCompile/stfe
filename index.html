<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Stranger Things Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

  <style>
    :root {
      --bg: #0b0b0b;
      --panel: #111;
      --border: #2a2a2a;
      --text: #fff;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      height: 100svh;
      display: flex;
      flex-direction: column;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: var(--panel);
      padding: 10px;
      display: flex;
      gap: 10px;
      border-bottom: 1px solid var(--border);
    }

    select {
      flex: 1;
      background: #1c1c1c;
      color: #fff;
      border: 1px solid var(--border);
      padding: 12px;
      font-size: 16px;
      border-radius: 6px;
      appearance: none;
    }

    form {
      display: flex;
      gap: 10px;
      width: 100%;
      align-items: center;
    }

    input,
    button {
      background: #1c1c1c;
      color: #fff;
      border: 1px solid var(--border);
      padding: 12px;
      font-size: 16px;
      border-radius: 6px;
    }

    input {
      flex: 2;
      min-width: 150px;
    }

    #episodeFields {
      display: flex;
      gap: 8px;
    }

    #episodeFields input {
      width: 90px;
    }

    button {
      cursor: pointer;
      background: #e50914;
      border-color: #b20710;
      flex: 0;
      white-space: nowrap;
    }

    .player-wrapper {
      position: relative;
      width: 100%;
      background: black;
      aspect-ratio: 16 / 9;
      flex-shrink: 0;
    }

    iframe {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: none;
    }

    @media (min-width: 768px) {
      body {
        height: 100vh;
      }

      header {
        justify-content: center;
        max-width: 900px;
        margin: 0 auto;
        width: 100%;
      }

      .player-wrapper {
        max-width: 900px;
        margin: 0 auto;
      }
    }
  </style>
</head>
<body>

  <header>
    <form id="searchForm">
      <select id="contentType" aria-label="Select content type">
        <option value="movie">Movie</option>
        <option value="tv">TV Show</option>
        <option value="episode" selected>Episode</option>
      </select>

      <select id="idType" aria-label="Select ID type">
        <option value="imdb" selected>IMDb</option>
        <option value="tmdb">TMDB</option>
      </select>

      <input
        id="idInput"
        type="text"
        aria-label="Enter IMDb or TMDB ID"
        placeholder="tt5433140 or 385687"
        value="tt4574334"
      />

      <div id="episodeFields">
        <input
          id="seasonInput"
          type="number"
          min="1"
          aria-label="Season number"
          value="1"
        />
        <input
          id="episodeInput"
          type="number"
          min="1"
          aria-label="Episode number"
          value="1"
        />
      </div>

      <button type="submit">Watch</button>
    </form>
  </header>

  <div class="player-wrapper">
    <iframe
      id="player"
      src=""
      allowfullscreen
      referrerpolicy="origin"
      sandbox="allow-scripts allow-same-origin allow-forms allow-presentation">
    </iframe>
  </div>

  <script>
    const BASE_URL = "https://vidsrc-embed.ru/embed";

    const form = document.getElementById("searchForm");
    const contentType = document.getElementById("contentType");
    const idType = document.getElementById("idType");
    const idInput = document.getElementById("idInput");
    const seasonInput = document.getElementById("seasonInput");
    const episodeInput = document.getElementById("episodeInput");
    const episodeFields = document.getElementById("episodeFields");
    const player = document.getElementById("player");

    function extractId(value, type) {
      const trimmed = value.trim();
      if (!trimmed) return "";

      if (type === "imdb") {
        const imdbMatch = trimmed.match(/tt\d+/i);
        if (imdbMatch) return imdbMatch[0];
      } else if (type === "tmdb") {
        const tmdbQueryMatch = trimmed.match(/tmdb=([0-9]+)/i);
        if (tmdbQueryMatch) return tmdbQueryMatch[1];

        const tmdbMatch = trimmed.match(/(?:movie|tv)\/(\d+)/i);
        if (tmdbMatch) return tmdbMatch[1];

        const digits = trimmed.match(/^\d+$/);
        if (digits) return digits[0];
      }

      return trimmed;
    }

    function toggleEpisodeFields() {
      const show = contentType.value === "episode";
      episodeFields.style.display = show ? "flex" : "none";
    }

    function buildUrl() {
      const id = extractId(idInput.value, idType.value);
      if (!id) return "";

      const params = new URLSearchParams();
      params.set(idType.value, id);

      const path = contentType.value === "movie" ? "movie" : "tv";

      if (contentType.value === "episode") {
        const season = seasonInput.value || 1;
        const episode = episodeInput.value || 1;
        params.set("season", season);
        params.set("episode", episode);
      }

      return `${BASE_URL}/${path}?${params.toString()}`;
    }

    form.addEventListener("submit", (event) => {
      event.preventDefault();
      const url = buildUrl();
      if (url) {
        player.src = url;
      }
    });

    contentType.addEventListener("change", toggleEpisodeFields);
    toggleEpisodeFields();
    const initialUrl = buildUrl();
    if (initialUrl) {
      player.src = initialUrl;
    }
  </script>

</body>
</html>
