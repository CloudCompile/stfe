<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Stranger Things Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

  <!-- CSP: blocks most popup + navigation bullshit at the page level -->
  <meta http-equiv="Content-Security-Policy"
    content="
      default-src 'self';
      script-src 'self' 'unsafe-inline';
      style-src 'self' 'unsafe-inline';
      frame-src https://vidsrc-embed.su;
      connect-src 'none';
      object-src 'none';
      base-uri 'none';
      form-action 'none';
    ">

  <style>
    :root {
      --bg: #0b0b0b;
      --panel: #111;
      --border: #2a2a2a;
      --text: #fff;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, sans-serif;
      height: 100svh;
      display: flex;
      flex-direction: column;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: var(--panel);
      padding: 10px;
      display: flex;
      gap: 10px;
      border-bottom: 1px solid var(--border);
    }

    select {
      flex: 1;
      background: #1c1c1c;
      color: #fff;
      border: 1px solid var(--border);
      padding: 12px;
      font-size: 16px;
      border-radius: 6px;
    }

    .player-wrapper {
      position: relative;
      width: 100%;
      background: black;
      aspect-ratio: 16 / 9;
    }

    iframe {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: none;
    }

    @media (min-width: 768px) {
      header,
      .player-wrapper {
        max-width: 900px;
        margin: 0 auto;
        width: 100%;
      }
    }
  </style>
</head>
<body>

<header>
  <select id="seasonSelect"></select>
  <select id="episodeSelect"></select>
</header>

<div class="player-wrapper">
  <iframe
    id="player"
    allow="fullscreen; autoplay">
  </iframe>
</div>

<script>
  /* ---------------- CORE CONFIG ---------------- */

  const imdbId = "tt4574334";
  const baseEmbed = "https://vidsrc-embed.su/embed/tv";

  const episodesPerSeason = {
    1: 8,
    2: 9,
    3: 8,
    4: 9
  };

  const seasonSelect = document.getElementById("seasonSelect");
  const episodeSelect = document.getElementById("episodeSelect");
  const player = document.getElementById("player");

  let lastSafeSrc = "";

  /* ---------------- UI LOGIC ---------------- */

  function loadSeasons() {
    for (const s in episodesPerSeason) {
      seasonSelect.add(new Option(`Season ${s}`, s));
    }
  }

  function loadEpisodes(season) {
    episodeSelect.innerHTML = "";
    for (let i = 1; i <= episodesPerSeason[season]; i++) {
      episodeSelect.add(new Option(`Episode ${i}`, i));
    }
  }

  function updatePlayer() {
    const src =
      `${baseEmbed}?imdb=${imdbId}&season=${seasonSelect.value}&episode=${episodeSelect.value}`;

    lastSafeSrc = src;
    player.src = src;
  }

  seasonSelect.onchange = () => {
    loadEpisodes(seasonSelect.value);
    episodeSelect.value = 1;
    updatePlayer();
  };

  episodeSelect.onchange = updatePlayer;

  /* ---------------- POPUP + REDIRECT BLOCKING ---------------- */

  // Kill window.open attempts at the parent level
  window.open = () => null;

  // Prevent top-level navigation hijacks
  window.addEventListener("beforeunload", e => {
    e.preventDefault();
    e.returnValue = "";
  });

  // If iframe tries to redirect itself, snap it back
  setInterval(() => {
    try {
      if (player.src !== lastSafeSrc) {
        player.src = lastSafeSrc;
      }
    } catch {
      // cross-origin tantrum, ignore
    }
  }, 1000);

  // Stop focus stealing (common popup trick)
  window.addEventListener("blur", () => {
    window.focus();
  });

  /* ---------------- INIT ---------------- */

  loadSeasons();
  seasonSelect.value = 1;
  loadEpisodes(1);
  episodeSelect.value = 1;
  updatePlayer();
</script>

</body>
</html>
